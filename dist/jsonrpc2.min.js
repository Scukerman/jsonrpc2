var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},JSONRPC2;!function(JSONRPC2){var Helper;!function(Helper){var GUID=function(){function GUID(){}return GUID.generate=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"==c?r:3&r|8;return v.toString(16)})},GUID}();Helper.GUID=GUID}(Helper=JSONRPC2.Helper||(JSONRPC2.Helper={}))}(JSONRPC2||(JSONRPC2={}));var JSONRPC2;!function(JSONRPC2){var Helper;!function(Helper){!function(LoggerType){LoggerType[LoggerType.LOG=0]="LOG",LoggerType[LoggerType.DEBUG=1]="DEBUG",LoggerType[LoggerType.ERROR=2]="ERROR",LoggerType[LoggerType.INFO=3]="INFO",LoggerType[LoggerType.WARN=4]="WARN"}(Helper.LoggerType||(Helper.LoggerType={}));var LoggerType=Helper.LoggerType,Logger=function(){function Logger(){}return Logger.log=function(){for(var messages=[],_i=0;_i<arguments.length;_i++)messages[_i-0]=arguments[_i];Logger.write(LoggerType.LOG,messages)},Logger.debug=function(){for(var messages=[],_i=0;_i<arguments.length;_i++)messages[_i-0]=arguments[_i];Logger.write(LoggerType.DEBUG,messages)},Logger.error=function(){for(var messages=[],_i=0;_i<arguments.length;_i++)messages[_i-0]=arguments[_i];Logger.write(LoggerType.ERROR,messages)},Logger.info=function(){for(var messages=[],_i=0;_i<arguments.length;_i++)messages[_i-0]=arguments[_i];Logger.write(LoggerType.INFO,messages)},Logger.warn=function(){for(var messages=[],_i=0;_i<arguments.length;_i++)messages[_i-0]=arguments[_i];Logger.write(LoggerType.WARN,messages)},Logger.write=function(type,messages){var date=Logger.getDate();messages.unshift("["+date+"]"),console[Logger.types[type]].apply(console,messages)},Logger.getDate=function(){var date=new Date;return[("0"+date.getDate()).slice(-2),("0"+(date.getMonth()+1)).slice(-2),date.getFullYear()].join("-")+" "+[("0"+date.getHours()).slice(-2),("0"+date.getMinutes()).slice(-2),("0"+date.getSeconds()).slice(-2)].join(":")},Logger.types=["log","debug","error","info","warn"],Logger}();Helper.Logger=Logger}(Helper=JSONRPC2.Helper||(JSONRPC2.Helper={}))}(JSONRPC2||(JSONRPC2={}));var JSONRPC2;!function(JSONRPC2){var Transport;!function(Transport){var HTTPConfig=function(){function HTTPConfig(){this.headers={Accept:"application/json","Content-Type":"application/json"}}return HTTPConfig}();Transport.HTTPConfig=HTTPConfig;var HTTP=function(){function HTTP(config){this.config=config}return HTTP.prototype.initiate=function(){},HTTP.prototype.doRequest=function(req){var dfd=jQuery.Deferred();return JSONRPC2.Helper.Logger.debug("==>",req.toJson()),jQuery.ajax({type:"POST",url:this.config.url,dataType:"text",data:req.toJson(),headers:this.config.headers,success:function(data,textStatus,jqXHR){if(JSONRPC2.Helper.Logger.debug("<==",data),void 0==data)return dfd.resolve(data);var res=JSONRPC2.Model.ServerResponse.fromJson(data);dfd.resolve(res)},error:function(jqXHR,textStatus,errorThrown){console.log("server error:",errorThrown,textStatus)}}),dfd.promise()},HTTP}();Transport.HTTP=HTTP}(Transport=JSONRPC2.Transport||(JSONRPC2.Transport={}))}(JSONRPC2||(JSONRPC2={}));var JSONRPC2;!function(JSONRPC2){var Transport;!function(Transport){var Logger=JSONRPC2.Helper.Logger,Websocket=function(){function Websocket(config){this.promises=[],this.reconnectionAttempts=0,this.timeout=0,this.wasReached=!1,this.options={url:config.url,reconnectionInterval:config.reconnectionInterval||1e3,maxReconnectionInterval:config.maxReconnectionInterval||3e4,reconnectDecay:config.reconnectDecay||2,maxReconnectAttempts:config.maxReconnectAttempts||0}}return Websocket.prototype.initiate=function(){this.connect()},Websocket.prototype.connect=function(){Logger.info("Connecting to",this.options.url),this.socket=new WebSocket(this.options.url),this.socket.addEventListener("open",this.onOpen.bind(this)),this.socket.addEventListener("close",this.onClose.bind(this)),this.socket.addEventListener("error",this.onError.bind(this)),this.socket.addEventListener("message",this.onMessage.bind(this))},Websocket.prototype.reconnect=function(){this.options.maxReconnectAttempts&&this.reconnectionAttempts>this.options.maxReconnectAttempts||(this.options.maxReconnectAttempts?Logger.info("Reconnecting ("+this.reconnectionAttempts+" of "+this.options.maxReconnectAttempts+")..."):Logger.debug("Reconnecting..."),this.connect())},Websocket.prototype.onOpen=function(ev){Logger.info("Connection established"),this.reconnectionAttempts=0,this.timeout=0,this.wasReached||(this.wasReached=!0)},Websocket.prototype.onClose=function(ev){ev.wasClean?Logger.info("The connection has been closed by server."):(0==this.reconnectionAttempts&&this.wasReached?Logger.info("The connection has been lost.","Code:",ev.code):Logger.info("The server cannot be reached."),this.timeout=Math.floor(this.options.reconnectionInterval*Math.pow(this.options.reconnectDecay,this.reconnectionAttempts)),setTimeout(function(){this.reconnectionAttempts++,this.reconnect()}.bind(this),this.timeout>this.options.maxReconnectionInterval?this.options.maxReconnectionInterval:this.timeout))},Websocket.prototype.onError=function(ev){Logger.error(ev)},Websocket.prototype.onMessage=function(ev){for(var res=JSONRPC2.Model.ServerResponse.fromJson(ev.data),i=0;i<this.promises.length;++i)if(this.promises[i][0]===res.getID())return Logger.debug("<==",ev.data),res instanceof JSONRPC2.Model.Error?this.promises[i][1].reject(res):this.promises[i][1].resolve(res),void this.promises.splice(i,1)},Websocket.prototype.isReady=function(){var dfd=jQuery.Deferred(),waitForState=function(){this.socket.readyState===WebSocket.OPEN?dfd.resolve(!0):setTimeout(waitForState,5)}.bind(this);return waitForState(),dfd.promise()},Websocket.prototype.doRequest=function(req){var dfd=jQuery.Deferred();return this.isReady().then(function(){Logger.debug("==>",req.toJson()),this.socket.send(req.toJson())}.bind(this)),this.promises.push([req.getID(),dfd]),dfd.promise()},Websocket}();Transport.Websocket=Websocket}(Transport=JSONRPC2.Transport||(JSONRPC2.Transport={}))}(JSONRPC2||(JSONRPC2={}));var JSONRPC2;!function(JSONRPC2){JSONRPC2.VERSION="2.0",JSONRPC2.ERROR_CODES={"-32700":"Parse error","-32600":"Invalid Request","-32601":"Method not found","-32602":"Invalid params","-32603":"Internal error","-32000":"Server error"}}(JSONRPC2||(JSONRPC2={}));var JSONRPC2;!function(JSONRPC2){var Client=function(){function Client(transport){this.transport=transport,transport.initiate()}return Client.prototype.execute=function(req){return this.transport.doRequest(req)},Client}();JSONRPC2.Client=Client}(JSONRPC2||(JSONRPC2={}));var JSONRPC2;!function(JSONRPC2){var Model;!function(Model){var ServerResponse=function(){function ServerResponse(){}return ServerResponse.fromJson=function(json){var res=JSON.parse(json);return"result"in res?new Model.Response(res.result,res.id):"error"in res?new Model.Error(res.error,res.id):void 0},ServerResponse.prototype.getID=function(){return this.id},ServerResponse}();Model.ServerResponse=ServerResponse}(Model=JSONRPC2.Model||(JSONRPC2.Model={}))}(JSONRPC2||(JSONRPC2={}));var JSONRPC2;!function(JSONRPC2){var Model;!function(Model){var ClientRequest=function(){function ClientRequest(method,params,id){this.jsonrpc=JSONRPC2.VERSION,this.method=method,this.params=params,this.id=id}return ClientRequest.prototype.toJson=function(){var pkt=this;return void 0==this.params&&(pkt=jQuery.extend(!0,{},this),delete pkt.params),JSON.stringify(pkt)},ClientRequest.prototype.send=function(c){return c.execute(this)},ClientRequest.prototype.getID=function(){return this.id},ClientRequest}();Model.ClientRequest=ClientRequest}(Model=JSONRPC2.Model||(JSONRPC2.Model={}))}(JSONRPC2||(JSONRPC2={}));var JSONRPC2;!function(JSONRPC2){var Model;!function(Model){var Request=function(_super){function Request(method,params){_super.call(this,method,params),this.id=JSONRPC2.Helper.GUID.generate()}return __extends(Request,_super),Request}(Model.ClientRequest);Model.Request=Request}(Model=JSONRPC2.Model||(JSONRPC2.Model={}))}(JSONRPC2||(JSONRPC2={}));var JSONRPC2;!function(JSONRPC2){var Model;!function(Model){var Notification=function(_super){function Notification(method,params){_super.call(this,method,params),this.id=void 0}return __extends(Notification,_super),Notification.prototype.send=function(c){return _super.prototype.send.call(this,c)},Notification}(Model.ClientRequest);Model.Notification=Notification}(Model=JSONRPC2.Model||(JSONRPC2.Model={}))}(JSONRPC2||(JSONRPC2={}));var JSONRPC2;!function(JSONRPC2){var Model;!function(Model){var Response=function(_super){function Response(result,id){_super.call(this),this.result=result,this.id=id}return __extends(Response,_super),Response.prototype.getResult=function(){return this.result},Response}(Model.ServerResponse);Model.Response=Response}(Model=JSONRPC2.Model||(JSONRPC2.Model={}))}(JSONRPC2||(JSONRPC2={}));var JSONRPC2;!function(JSONRPC2){var Model;!function(Model){var Error=function(_super){function Error(error,id){_super.call(this),this.error=error,this.id=id}return __extends(Error,_super),Error.prototype.getCode=function(){return this.error.code},Error.prototype.getMessage=function(){return this.error.message},Error.prototype.getData=function(){return this.error.data||{}},Error}(Model.ServerResponse);Model.Error=Error}(Model=JSONRPC2.Model||(JSONRPC2.Model={}))}(JSONRPC2||(JSONRPC2={}));